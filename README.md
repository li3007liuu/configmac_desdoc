# configmac_desdoc(智能配药机设计文档)
## 嵌入式设备与服务器后台通信说明
嵌入式设备通过tcp连接，实现与服务器后台之间通信，小程序通过http协议与嵌入式设备之间实现通信。

下面记录嵌入式设备通信API格式：
整个协议帧包含<br>数据头（2Byte） 设备唯一标志码PID（8Byte） 协议类型（1Byte） 数据帧长度（1Byte） 数据帧（xxByte） CRC校验（2Byte） 数据尾（2Byte）<br/>
控制命令帧数据帧格式为
<br>控制命令（1Byte）控制命令参数个数（1Byte）参数类型0（1Byte）参数值0（nByte）参数类型1（1Byte）参数值1（nByte）……<br/>

控制命令对应如下：（hex）控制命令描述<br/>
01 设备注册     
02 更新密码     
03 更新设备状态     
1E 添加药瓶     
1F 删除药瓶     
20 开始配药     

错误码类型如下：<br/>
07 长度错误       
06 数据头尾校验错误     
05 数据CRC校验错误      
04 协议帧类型错误      
03 数据dat转换错误      
00 正确返回     

### 01设备注册
描述：通过设备MAC地址及密码向服务器端注册设备，换取设备唯一标志码PID。<br/>
参数总数：6<br/>
参数1：产品系列编码 参数类型 10 参数位数1Byte <br/>
参数2：产品类型编码 参数类型 11 参数位数1Byte<br/>
参数3：产品批次编码 参数类型 12 参数位数1Byte<br/>
参数4：配药机可操作药瓶总数 参数类型 15 参数位数1Byte<br/>
参数5：设备MAC地址 参数类型 C0 参数位数8Byte<br/>
参数6：设备初始密码 参数地址 C1 参数位数8Byte<br/>
成功返回：<br/>
参数1：返回错误码 参数类型 00 参数位数1Byte<br/>
参数2：返回注册成功PID 参数类型 C2 参数位数8Byte<br/>
错误返回：<br/>
参数1：返回错误码 参数类型 00 参数位数1Byte<br/>
示例请求：<br/>
FFFE<br/>
0000000000000000 -》设备ID注册时ID为全0<br/>
A3 -》帧类型嵌入式设备请求控制帧<br/>
1C -》数据总数<br/>
01 -》控制命令编码 01 为设备注册<br/>
06 -》控制命令参数个数 为6个参数个数<br/>
10 -》产品系列编码<br/>
0B -》0B为配药机系列<br/>
11 -》产品类型编码<br/>
01 -》01为配药机产品类型<br/>
12 -》产品批次编码<br/>
00 -》产品批次为00<br/>
15 -》设备单元总数编码<br/>
07 -》有七个设备单元<br/>
C0 -》设备MAC地址编码<br/>
0000000000000000<br/>
C1 -》设备Pass地址编码<br/>
0000000000000000<br/>
AA25<br/>
FFFD<br/>
成功返回：<br/>
FFFE<br/>
0000000000000000<br/>
23-》帧类型<br/>
0D-》数据总数<br/>
01-》控制命令编码01为设备注册<br/>
02-》返回参数个数02<br/>
00-》返回错误码<br/>
00-》0为无错误<br/>
C2-》返回pid<br/>
0B01000000000585<br/>
8C04<br/>
FFFD<br/>
错误返回<br/>
FFFE <br/>
0000000000000000<br/>
20-》帧类型<br/>
02-》数据总数<br/>
00-》返回错误码类型<br/>
05-》返回错误码值<br/>
010E<br/> 
FFFD<br/>


